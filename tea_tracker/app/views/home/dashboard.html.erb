<h1 class="mt-5 text-center">Welcome to Tea Tracker</h1>

<% if current_user %>
  <div class="text-center my-4">
    <% if current_user.avatar_url.present? %>
      <img src="<%= current_user.avatar_url %>" class="rounded-circle mb-3" alt="Avatar" width="120">
    <% end %>
    <p>You are logged in as <strong><%= current_user.username %></strong></p>
    <p class="text-muted"><%= current_user.bio %></p>
  </div>

  <div class="d-flex justify-content-center mb-4">
    <%= link_to "Add New Tea", new_tea_path, class: "btn btn-success me-2" %>
    <%= link_to "Logout", logout_path, method: :delete, class: "btn btn-outline-danger" %>
  </div>

  <h2 class="text-center">Overview</h2>
  <div class="row mt-4">
    <!-- Tea Types -->
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">Tea Types</h5>
        </div>
        <div class="card-body">
          <% @tea_type_counts.each do |category, count| %>
            <div class="d-flex align-items-center mb-2">
              <span class="me-2"><%= category %>:</span>
              <div class="progress w-75">
                <div class="progress-bar bg-success" role="progressbar" style="width: <%= (count.to_f / @tea_type_counts.values.max) * 100 %>%;" aria-valuenow="<%= count %>" aria-valuemin="0" aria-valuemax="<%= @tea_type_counts.values.max %>">
                  <%= count %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Popular Shipping Locations -->
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Popular Shipping Locations</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            <% @popular_ship_from.each do |location, count| %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <%= location %>
                <span class="badge bg-primary rounded-pill"><%= count %></span>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Total Teas and Average Cost -->
  <div class="row">
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">Total Teas</h5>
        </div>
        <div class="card-body text-center">
          <h3><%= @total_teas %></h3>
          <p class="text-muted">teas in your collection</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-warning text-white">
          <h5 class="mb-0">Average Tea Cost</h5>
        </div>
        <div class="card-body text-center">
          <h3><%= number_to_currency(@average_tea_cost) %></h3>
          <p class="text-muted">average cost per tea</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Ranked, Most Expensive, and Least Popular Teas -->
  <div class="row">
    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0">Top Ranked Tea</h5>
        </div>
        <div class="card-body text-center">
          <% if @top_ranked_tea %>
            <h6><strong><%= @top_ranked_tea.name %></strong></h6>
            <p class="text-muted"><%= @top_ranked_tea.category %> (Rank: <%= @top_entry.rank %>)</p>
          <% else %>
            <p class="text-muted">No ranked teas yet.</p>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">Most Expensive Tea</h5>
        </div>
        <div class="card-body text-center">
          <% if @most_expensive_tea %>
            <h6><strong><%= @most_expensive_tea.name %></strong></h6>
            <p class="text-muted"><%= number_to_currency(@most_expensive_tea.price) %> (<%= @most_expensive_tea.category %>)</p>
          <% else %>
            <p class="text-muted">No teas with a price yet.</p>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">Least Popular Tea</h5>
        </div>
        <div class="card-body text-center">
          <% if @least_popular_tea %>
            <h6><strong><%= @least_popular_tea.name %></strong></h6>
            <p class="text-muted">Popularity: <%= @least_popular_tea.popularity %></p>
          <% else %>
            <p class="text-muted">No teas with a popularity score yet.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="text-center mt-4">
    <%= link_to "View All Teas", teas_path, class: "btn btn-primary btn-lg" %>
  </div>
<% else %>
  <p class="text-center"><%= link_to "Login", new_session_path %> or <%= link_to "Sign Up", new_user_path %> to get started tracking your teas.</p>
<% end %>


